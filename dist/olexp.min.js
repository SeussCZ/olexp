/* olexp 0.3.0 (c) Daniel Pulido <dpmcmlxxvi@gmail.com> */

window.olexp=window.olexp||{},function(h){"use strict";var o=function(t,e){if(void 0===t)throw new Error("olexp.Explorer: id not defined");if(0===$("#"+t).length)throw new Error("olexp.Explorer: id not found");var o="olexp-"+t;this.options={controls:{editsettings:!0,exportmap:!0,graticule:!0,layercontrol:!0,layermanager:!0,layermenu:!0,measure:!0,toolbarhide:!0},details:{hidden:!0,resizable:!0,size:"25%",type:"preview"},layers:{expanded:!0,group:!0,img:"icon-folder",text:"Layers"},map:{type:"main"},navigation:{resizable:!0,size:"15%",type:"left"},olcontrols:{fullscreen:!0,mouseposition:!0,overviewmap:!0,rotate:!0,scaleline:!0,zoom:!0,zoomslider:!0,zoomtoextent:!0},olinteractions:{draganddrop:!0},olmap:{controls:[],view:new ol.View({center:[0,0],zoom:3})},outline:{type:"main"},overlays:{expanded:!0,group:!0,img:"icon-folder",text:"Overlays"},settings:{},toolbar:{size:"40",style:"padding: 5px;",type:"top"}},$.extend(!0,this.options,e),$.extend(!0,this.options,{explorer:{cls:"olexp-explorer-content",id:o+"-explorer-id-content",details:o+"-explorer-name-details",layout:o+"-explorer-name-layout",navigation:o+"-explorer-name-navigation",outline:o+"-explorer-name-outline",toolbar:o+"-explorer-name-toolbar"},layers:{id:o+"-explorer-id-layers"},map:{content:'<div id="'+o+'-explorer-id-map" class="olexp-explorer-map"></div>'},olmap:{target:o+"-explorer-id-map"},overlays:{id:o+"-explorer-id-overlays"},settings:{prefix:o}});var i=this,n=$("<div>",{id:this.options.explorer.id,class:this.options.explorer.cls});$("#"+t).append(n),this.layout=$("#"+this.options.explorer.id).w2layout({name:this.options.explorer.layout,panels:[this.options.navigation,this.options.map,this.options.toolbar]}),this.toolbar=$("").w2toolbar({name:this.options.explorer.toolbar}),this.navigation=$("").w2layout({name:this.options.explorer.navigation,onResize:function(){i.hasOwnProperty("map")&&i.map.updateSize(),i.hasOwnProperty("details")&&i.details.resize()},panels:[this.options.outline,this.options.details]}),this.outline=$("").w2sidebar({name:this.options.explorer.outline,nodes:[this.options.layers,this.options.overlays],onClick:function(t){var e=t.target,o=i.manager.getDetails(e);i.details.clear(),i.details.add(o),i.manager.onItemSelected(e)},onDblClick:function(t){var e=t.target;i.manager.toggleNode(e),i.manager.onItemSelected(e)},onRender:function(t){t.onComplete=function(){var t=i.outline.selected;i.manager.onItemSelected(t)}}}),this.details=$("").w2grid({columns:[{field:"property",caption:"Property",size:"100%",sortable:!0},{field:"value",caption:"Value",size:"100%",sortable:!0}],name:this.options.explorer.details}),this.navigation.content(this.options.outline.type,this.outline),this.navigation.content(this.options.details.type,this.details),this.layout.content(this.options.navigation.type,this.navigation),this.map=new ol.Map(this.options.olmap),this.manager=new h.manager.Manager(this.map,this.outline,this.details,this.options.layers.id,this.options.overlays.id);var r=h.menu.Zoom(this.manager,this.options.settings),s=h.menu.Properties(this.manager,this.options.settings),a=h.menu.Remove(this.manager,this.options.settings);this.menu={items:[],callbacks:{}},this.menu.items.push(r.menu),this.menu.items.push(s.menu),this.menu.items.push(a.menu),this.menu.callbacks[r.menu.id]=r.click,this.menu.callbacks[s.menu.id]=s.click,this.menu.callbacks[a.menu.id]=a.click,this.outline.menu=this.menu.items,this.outline.onMenuClick=function(t){var e=t.menuItem.id;void 0!==i.menu.callbacks[e]&&i.menu.callbacks[e](t)},this.util=new h.util.Util(this.options.settings);var l=this.util.getInteractions(this.map);Object.keys(this.options.olinteractions).forEach(function(t){var e=l[t];i.options.olinteractions[t]&&i.map.addInteraction(e)});var p=this.util.getControls();Object.keys(this.options.olcontrols).forEach(function(t){var e=p[t];i.map.addControl(e),e.setMap(i.options.olcontrols[t]?i.map:null)}),this.selector=new h.selection.Feature(this.map,this.details),this.selector.setEnable(!0),this.api={details:this.details,layout:this.layout,manager:this.manager,map:this.map,navigation:this.navigation,options:this.options,outline:this.outline,toolbar:this.toolbar},this.options.controls.toolbarhide&&(this.toolbar.add(h.control.ToolbarHide(this.api,{hidden:this.options.toolbar.hidden,settings:this.options.settings})),this.toolbar.add({id:"break-toolbar-hide",type:"break"})),this.options.controls.layermanager&&(this.toolbar.add(h.control.LayerManager(this.api,this.manager,{details:{checked:!this.options.details.hidden},navigation:{checked:!this.options.navigation.hidden},settings:this.options.settings})),this.toolbar.add({id:"break-layer-manager",type:"break"})),this.options.controls.layermenu&&(this.toolbar.add(h.control.LayerMenu(this.api,this.manager,this.menu,{settings:this.options.settings})),this.toolbar.add({id:"break-item-menu",type:"break"})),this.options.controls.layercontrol&&(this.toolbar.add(h.control.LayerControl(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-layer-control",type:"break"})),this.options.controls.graticule&&(this.toolbar.add(h.control.Graticule(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-graticule",type:"break"})),this.options.controls.measure&&(this.toolbar.add(h.control.Measure(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-measure",type:"break"})),this.options.controls.exportmap&&(this.toolbar.add(h.control.ExportMap(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-export-map",type:"break"})),this.options.controls.editsettings&&(this.toolbar.add(h.control.EditSettings(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-edit-settings",type:"break"})),this.layout.set(this.options.toolbar.type,{content:"",show:{toolbar:!0},toolbar:this.toolbar})};h.destroy=function(t){void 0!==t.map&&t.map.setTarget(null),void 0!==t.details&&t.details.destroy(),void 0!==t.outline&&t.outline.destroy(),void 0!==t.navigation&&t.navigation.destroy(),void 0!==t.toolbar&&t.toolbar.destroy(),void 0!==t.layout&&t.layout.destroy()},h.Explorer=function(t,e){return new o(t,e).api}}(olexp||{}),window.olexp.event=window.olexp.event||{},function(t){"use strict";var e=function(t){this.listeners=$.extend({},t)};e.prototype.on=function(t,e,o){if(void 0!==this.listeners[t]){var i=e;void 0!==o&&(i=e.bind(o)),this.listeners[t].push(i)}},e.prototype.register=function(t){void 0===this.listeners[t]&&(this.listeners[t]=[])},e.prototype.trigger=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(void 0!==this.listeners[t]){var o=this;this.listeners[t].forEach(function(t){t.apply(o,e)})}},e.prototype.unregister=function(t){if(void 0===this.listeners[t])return[];var e=this.listeners[t];return delete this.listeners[t],e},e.prototype.off=function(t,e,o){if(void 0!==this.listeners[t]){var i=e;void 0!==o&&(i=e.bind(o));var n=this.listeners[t].indexOf(i);-1<n&&this.listeners[t].splice(n,1)}},t.event.Event=function(t){return new e(t)}}(olexp||{}),window.olexp.control=window.olexp.control||{},function(r){"use strict";var i=function(t,e){var o=$.extend(!0,{control:{EditSettings:{form:{header:"",style:"border: 0px; background-color: transparent;"},hint:"Edit Controls",popup:{height:380,style:"width: 100%; height: 100%;",title:"Edit Controls",width:225},span:6}}},e);this.settings=o.control.EditSettings,this.button=e.prefix+"-control-edit-settings-button",this.icon="olexp-control-edit-settings",this.id=e.prefix+"-control-edit-settings-form",this.map=t,this.name=e.prefix+"-control-edit-settings-form"};i.prototype.display=function(){var i=this,t=[{html:{caption:"Full Screen",span:this.settings.span},name:"fullscreen",type:"checkbox"},{html:{caption:"Mouse Position",span:this.settings.span},name:"mouseposition",type:"checkbox"},{html:{caption:"Overview Map",span:this.settings.span},name:"overviewmap",type:"checkbox"},{html:{caption:"Rotate",span:this.settings.span},name:"rotate",type:"checkbox"},{html:{caption:"Scale Line",span:this.settings.span},name:"scaleline",type:"checkbox"},{html:{caption:"Zoom",span:this.settings.span},name:"zoom",type:"checkbox"},{html:{caption:"Zoom Slider",span:this.settings.span},name:"zoomslider",type:"checkbox"},{html:{caption:"Zoom To Extent",span:this.settings.span},name:"zoomtoextent",type:"checkbox"}],e={fullscreen:this.isControlActive("fullscreen"),mouseposition:this.isControlActive("mouseposition"),overviewmap:this.isControlActive("overviewmap"),rotate:this.isControlActive("rotate"),scaleline:this.isControlActive("scaleline"),zoom:this.isControlActive("zoom"),zoomslider:this.isControlActive("zoomslider"),zoomtoextent:this.isControlActive("zoomtoextent")},o=$.extend(this.settings.form,{fields:t,name:this.name,record:e}),n=this.settings.popup;r.util.popup(this.id,function(o){Object.keys(o).forEach(function(t){var e=o[t];i.setControl(t,e)})},o,n)},i.prototype.getControl=function(e){var t=this.map.getControls().getArray(),o=null;return t.forEach(function(t){null===o&&("fullscreen"===e&&t instanceof ol.control.FullScreen?o=t:"mouseposition"===e&&t instanceof ol.control.MousePosition?o=t:"overviewmap"===e&&t instanceof ol.control.OverviewMap?o=t:"rotate"===e&&t instanceof ol.control.Rotate?o=t:"scaleline"===e&&t instanceof ol.control.ScaleLine?o=t:"zoom"===e&&t instanceof ol.control.Zoom?o=t:"zoomslider"===e&&t instanceof ol.control.ZoomSlider?o=t:"zoomtoextent"===e&&t instanceof ol.control.ZoomToExtent&&(o=t))}),o},i.prototype.isControlActive=function(t){var e=this.getControl(t);return null!==e&&null!==e.getMap()},i.prototype.setControl=function(t,e){var o=this.getControl(t);if(null!==o){var i=e?this.map:null;o.setMap(i)}},r.control.EditSettings=function(t,e){var o=new i(t.map,e.settings);return{hint:o.settings.hint,id:o.button,img:o.icon,onClick:function(){o.display()},type:"button"}}}(olexp||{}),function(t){"use strict";var i=function(t,e){var o=$.extend(!0,{control:{ExportMap:{filename:"map.png",hint:"Export map"}}},e);this.settings=o.control.ExportMap,this.anchor=e.prefix+"-control-export-map-anchor",this.button=e.prefix+"-control-export-map-button",this.filename=this.settings.filename,this.icon="olexp-control-export-map",this.map=t};i.prototype.toImage=function(){var t=this.anchor,e=this.filename;$("body").append('<a id="'+t+'" download="'+e+'"></a>');var o=document.getElementById(t);o.addEventListener("click",function(){this.map.once("postcompose",function(t){o.href=t.context.canvas.toDataURL("image/png")}),this.map.renderSync()}.bind(this),!1),$("#"+t)[0].click(),$("#"+t).remove()},t.control.ExportMap=function(t,e){var o=new i(t.map,e.settings);return{hint:o.settings.hint,id:o.button,img:o.icon,onClick:function(){o.toImage()},type:"button"}}}(olexp||{}),function(r){"use strict";var i=function(t,e){var o=$.extend(!0,{control:{Graticule:{enable:!1,form:{header:"",style:"border: 0px; background-color: transparent;"},hint:"Edit Grid Lines",options:{color:"000000",lineDash:[.5,4],width:2},popup:{height:225,style:"border: 0px; background-color: transparent;",title:"Edit Grid Lines",width:300},span:3}}},e);this.settings=o.control.Graticule,this.button=e.prefix+"-control-graticule-button",this.icon="olexp-control-graticule",this.id=e.prefix+"-control-graticule",this.map=t,this.name=e.prefix+"-control-graticule-form",this.util=new r.util.Util(o),this.graticule=this.util.getGraticule(this.settings.enable?this.map:null,$.extend({},this.settings.options))};i.prototype.display=function(){var o=this,t=[{html:{caption:"Enable",span:this.settings.span},name:"enable",required:!0,type:"checkbox"},{html:{caption:"Color",span:this.settings.span},name:"color",options:{silent:!1},required:!0,type:"color"},{html:{caption:"Width",span:this.settings.span},name:"width",options:{arrows:!0,max:4,min:.25,placeholder:"0.25 - 4",silent:!1,step:.25},required:!0,type:"float"}],i=this.graticule.olexpRecord,e=$.extend(this.settings.form,{fields:t,name:this.name,record:i}),n=this.settings.popup;r.util.popup(this.id,function(e){Object.keys(e).forEach(function(t){i[t]=e[t]});var t=$.extend({},i);delete t.enable,o.graticule.setMap(null),o.graticule=o.util.getGraticule(i.enable?o.map:null,t)},e,n)},r.control.Graticule=function(t,e){void 0===e&&(e={}),void 0===e.settings&&(e.settings={});var o=new i(t.map,e.settings);return{hint:o.settings.hint,id:o.button,img:o.icon,onClick:function(){o.display()},type:"button"}}}(olexp||{}),function(c){"use strict";var n=function(t,e){var o=$.extend(!0,{control:{LayerControlTile:{form:{header:"",style:"border: 0px; background-color: transparent;"},hint:"Add Tile Layer",popup:{height:165,style:"border: 0px; background-color: transparent;",title:"Add Tile Layer",width:290},span:3},LayerControlVector:{form:{header:"File Types: "+$.map(c.util.FileTypes,function(t){return" "+t.name}),style:"border: 0px; background-color: transparent;"},hint:"Add Vector Layer",popup:{height:195,style:"border: 0px; background-color: transparent;",title:"Add Vector Layer",width:350},span:4}}},e);this.settingsTile=o.control.LayerControlTile,this.settingsVector=o.control.LayerControlVector,this.icons={tile:"olexp-control-layer-control-add-tile",vector:"olexp-control-layer-control-add-vector"},this.buttons={tile:e.prefix+"-control-layer-control-add-tile-button",vector:e.prefix+"-control-layer-control-add-vector-button"},this.ids={tile:e.prefix+"-control-layer-control-add-tile",vector:e.prefix+"-control-layer-control-add-vector"},this.map=t,this.names={tile:e.prefix+"-control-tile-form",vector:e.prefix+"-control-vector-form"},this.util=new c.util.Util(this.map)};n.prototype.tile=function(){var r=this,s=this.util.getTileTypes(),t=$.map(s,function(t){return t.name}),o=[{field:"tile_source",html:{caption:"Source",span:this.settingsTile.span},options:{items:t},required:!0,type:"list"}],e={};e[o[0].field]=null;var i=$.extend(this.settingsTile.form,{fields:o,name:this.names.tile,record:e}),n=this.settingsTile.popup;c.util.popup(this.ids.tile,function(e){Object.keys(e).forEach(function(t){if(t===o[0].field){var n=e[t].id;Object.keys(s).forEach(function(t){if(n===s[t].name){var e=s[t],o=e.class,i=new ol.layer.Tile({source:new o(e.settings)});i.set("name",n),r.map.addLayer(i)}})}})},i,n)},n.prototype.vector=function(){var h=this,t=[{field:"vector_source",html:{caption:"Source",span:this.settingsVector.span},options:{placeholder:"Click to add file",silent:!1},required:!0,type:"file"}],e={};e[t[0].field]=null;var o=$.extend(this.settingsVector.form,{fields:t,name:this.names.vector,record:e}),i=this.settingsVector.popup;c.util.popup(this.ids.vector,function(p){Object.keys(p).forEach(function(l){l===t[0].field&&Object.keys(p[l]).forEach(function(t){var e=p[l][t].content;if(null!=e){var o=p[l][t].name,i=c.util.setExtension(o,""),n=c.util.getReader(o);if(null!==n){var r=atob(e),s={featureProjection:h.map.getView().getProjection()},a=n.readFeatures(r,s);h.util.addLayerVector(h.map,i,a)}else w2alert("Unable to open file "+o,"Error")}})})},o,i)},c.control.LayerControl=function(t,e){void 0===e&&(e={}),void 0===e.tile&&(e.tile=!0),void 0===e.vector&&(e.vector=!0),void 0===e.settings&&(e.settings={});var o=new n(t.map,e.settings),i=[];return e.tile&&i.push({hint:o.settingsTile.hint,id:o.buttons.tile,img:o.icons.tile,onClick:function(){o.tile()},type:"button"}),e.vector&&i.push({hint:o.settingsVector.hint,id:o.buttons.vector,img:o.icons.vector,onClick:function(){o.vector()},type:"button"}),i}}(olexp||{}),function(t){"use strict";var r=function(t,e,o){var i=$.extend(!0,{control:{LayerManager:{hintDetailsHide:"Hide details",hintDetailsShow:"Show details",hintMoveDown:"Move item down",hintMoveUp:"Move item up",hintOutlineHide:"Hide outline",hintOutlineShow:"Show outline"}}},o);this.buttons={details:o.prefix+"-control-layer-manager-button-details",down:o.prefix+"-control-layer-manager-button-down",navigation:o.prefix+"-control-layer-manager-button-navigation",up:o.prefix+"-control-layer-manager-button-up"},this.explorer=t,this.icons={details:"olexp-control-layer-manager-details",down:"olexp-control-layer-manager-down",navigation:"olexp-control-layer-manager-navigation",up:"olexp-control-layer-manager-up"},this.manager=e,this.settings=i.control.LayerManager,this.manager.on("remove:item",this.onItemRemoved,this),this.manager.on("select:item",this.onItemSelected,this)};r.prototype.details=function(){this.explorer.navigation.toggle(this.explorer.options.details.type);var t=this.explorer.navigation.get(this.explorer.options.details.type);this.explorer.toolbar.get(this.buttons.details).hint=this.hintDetails(t.hidden),this.explorer.toolbar.refresh()},r.prototype.down=function(){this.manager.moveDown()},r.prototype.hintDetails=function(t){return t?this.settings.hintDetailsShow:this.settings.hintDetailsHide},r.prototype.hintNavigation=function(t){return t?this.settings.hintOutlineShow:this.settings.hintOutlineHide},r.prototype.navigation=function(){this.explorer.layout.toggle(this.explorer.options.navigation.type);var t=this.explorer.layout.get(this.explorer.options.navigation.type);this.explorer.toolbar.get(this.buttons.navigation).hint=this.hintNavigation(t.hidden),this.explorer.toolbar.refresh()},r.prototype.onItemRemoved=function(t){this.manager.isSelected(t.id)&&(this.explorer.toolbar.disable(this.buttons.up),this.explorer.toolbar.disable(this.buttons.down))},r.prototype.onItemSelected=function(t){if(void 0!==t){var e=this.manager.getById(t);if(null!==e)this.manager.getNode(e.id).disabled?(this.explorer.toolbar.disable(this.buttons.up),this.explorer.toolbar.disable(this.buttons.down)):(this.explorer.toolbar.enable(this.buttons.up),this.explorer.toolbar.enable(this.buttons.down))}},r.prototype.up=function(){this.manager.moveUp()},t.control.LayerManager=function(t,e,o){void 0===o&&(o={}),void 0===o.details&&(o.details={}),void 0===o.details.enabled&&(o.details.enabled=!0),void 0===o.details.checked&&(o.details.checked=!0),void 0===o.down&&(o.down=!0),void 0===o.navigation&&(o.navigation={}),void 0===o.navigation.enabled&&(o.navigation.enabled=!0),void 0===o.navigation.checked&&(o.navigation.checked=!0),void 0===o.up&&(o.up=!0);var i=new r(t,e,o.settings),n=[];return o.navigation.enabled&&n.push({checked:o.navigation.checked,hint:i.hintNavigation(!o.navigation.checked),id:i.buttons.navigation,img:i.icons.navigation,onClick:function(){i.navigation()},type:"check"}),o.details.enabled&&n.push({checked:o.details.checked,hint:i.hintDetails(!o.details.checked),id:i.buttons.details,img:i.icons.details,onClick:function(){i.details()},type:"check"}),o.up&&n.push({disabled:!0,hint:i.settings.hintMoveUp,id:i.buttons.up,img:i.icons.up,onClick:function(){i.up()},type:"button"}),o.down&&n.push({disabled:!0,hint:i.settings.hintMoveDown,id:i.buttons.down,img:i.icons.down,onClick:function(){i.down()},type:"button"}),n}}(olexp||{}),function(t){"use strict";var o=function(t,e,o,i){var n=$.extend(!0,{control:{LayerMenu:{arrow:!0,hint:"Item Options",text:""}}},i);this.button=i.prefix+"-control-layer-menu",this.explorer=t,this.icon="olexp-control-layer-menu",this.manager=e,this.menu=o,this.settings=n.control.LayerMenu,this.manager.on("remove:item",this.onItemRemoved,this),this.manager.on("select:item",this.onItemSelected,this)};o.prototype.onItemRemoved=function(t){this.manager.isSelected(t.id)&&this.explorer.toolbar.disable(this.button)},o.prototype.onItemSelected=function(t){if(void 0!==t){var e=this.manager.getById(t);if(null!==e)this.manager.getNode(e.id).disabled?this.explorer.toolbar.disable(this.button):this.explorer.toolbar.enable(this.button)}},t.control.LayerMenu=function(i,t,n,e){var r=new o(i,t,n,e.settings);return i.toolbar.on("click",function(t){if(null!==i.outline.selected){var e=r.button+":";if(!(t.target.indexOf(e)<0)){var o=t.target.replace(e,"");void 0!==n.callbacks[o]&&n.callbacks[o]({target:i.outline.selected})}}}),{arrow:r.settings.arrow,disabled:!0,hint:r.settings.hint,id:r.button,img:r.icon,items:r.menu.items,text:r.settings.text,type:"menu"}}}(olexp||{}),function(i){"use strict";var n=function(t,e){var o=$.extend(!0,{control:{Measurement:{hintArea:"Measure area",hintLength:"Measure length"}}},e);this.explorer=t,this.icons={area:"olexp-control-measure-area",length:"olexp-control-measure-length"},this.ids={area:e.prefix+"-control-measure-area-button",length:e.prefix+"-control-measure-length-button"},this.settings=o.control.Measurement,this.tool=new i.measure.Tool(t.map,{type:i.measure.Type.LINE,settings:e})};n.prototype.area=function(){var t=!this.explorer.toolbar.get(this.ids.area).checked;this.measure(i.measure.Type.AREA,t)},n.prototype.length=function(){var t=!this.explorer.toolbar.get(this.ids.length).checked;this.measure(i.measure.Type.LINE,t)},n.prototype.measure=function(t,e){this.tool.setEnable(!1),e&&(this.tool.setType(t),this.tool.setEnable(!0))},i.control.Measure=function(t,e){void 0===e&&(e={}),void 0===e.area&&(e.area=!0),void 0===e.length&&(e.length=!0),void 0===e.settings&&(e.settings={});var o=new n(t,e.settings),i=[];return e.area&&i.push({hint:o.settings.hintArea,id:o.ids.area,img:o.icons.area,onClick:function(){e.length&&t.toolbar.uncheck(o.ids.length),o.area()},type:"check"}),e.length&&i.push({hint:o.settings.hintLength,id:o.ids.length,img:o.icons.length,onClick:function(){e.area&&t.toolbar.uncheck(o.ids.area),o.length()},type:"check"}),i}}(olexp||{}),function(i){"use strict";var n=function(t,e){var o=$.extend(!0,{control:{ToolbarHide:{hint:"Hide toolbar"}}},e.settings);this.button=e.settings.prefix+"-control-toolbar-hide-button",this.explorer=t,this.icon="olexp-control-toolbar-hide",this.settings=o.control.ToolbarHide,this.show=i.ol.ToolbarShow(this.explorer,e)};n.prototype.hide=function(){this.explorer.layout.hide(this.explorer.options.toolbar.type),this.show.setMap(this.explorer.map)},i.control.ToolbarHide=function(t,e){var o=new n(t,e);return{hint:o.settings.hint,id:o.button,img:o.icon,onClick:function(){o.hide()},type:"button"}}}(olexp||{}),window.olexp.item=window.olexp.item||{},function(n){"use strict";n.item.icons={group:"olexp-item-group",heatmap:"olexp-item-heatmap",image:"olexp-item-image",overlay:"olexp-item-overlay",tile:"olexp-item-tile",vector:"olexp-item-vector"};var r=function(t,e,o){this.id=t,this.layer=o,this.moving=!1,this.name=e,this.type=r.getType(this.layer),this.icon=r.getIcon(this.type)};r.prototype.getDetails=function(){var t={};t.Name=this.name;var e=this.layer.getProperties();if(e.hasOwnProperty(n.measure.properties.area)?t.Area=e[n.measure.properties.area]:e.hasOwnProperty(n.measure.properties.length)&&(t.Length=e[n.measure.properties.length]),this.type===n.item.Type.GROUP){var o=this.layer.getLayers();t["Layer Count"]=o.getLength()}if(this.type===n.item.Type.VECTOR){var i=this.layer.getSource().getFeatures();t["Feature Count"]=i.length}return n.util.toRecords(t)},r.prototype.getExtent=function(){if(this.type===n.item.Type.OVERLAY)return null;if(this.type===n.item.Type.GROUP){var o=null;return this.layer.getLayers().forEach(function(t){var e=r.getLayerExtent(t);null===o&&null!==e?o=e:null!==o&&null!==e&&(o=ol.extent.extend(o,e))},this),o}return r.getLayerExtent(this.layer)},r.getIcon=function(t){return t===n.item.Type.GROUP?n.item.icons.group:t===n.item.Type.HEATMAP?n.item.icons.heatmap:t===n.item.Type.IMAGE?n.item.icons.image:t===n.item.Type.OVERLAY?n.item.icons.overlay:t===n.item.Type.TILE?n.item.icons.tile:t===n.item.Type.VECTOR?n.item.icons.vector:"icon-page"},r.getLayerExtent=function(t){var e=t.getExtent();if(void 0===e){var o=t.getSource();null!==o&&(o instanceof ol.source.Cluster||o instanceof ol.source.VectorTile||o instanceof ol.source.Vector)&&(e=o.getExtent())}return void 0===e?null:e},r.prototype.getPropertyTypes=function(){return this.layer instanceof ol.layer.Layer?n.item.LayerProperties:this.layer instanceof ol.Overlay?n.item.OverlayProperties:{}},r.prototype.getProperties=function(){var e={name:this.name},t=this.getPropertyTypes(),o=this;return Object.keys(t).forEach(function(t){e[t]=o.layer.get(t)}),e},r.getType=function(t){return t instanceof ol.layer.Group?n.item.Type.GROUP:t instanceof ol.layer.Heatmap?n.item.Type.HEATMAP:t instanceof ol.layer.Image?n.item.Type.IMAGE:t instanceof ol.layer.Tile?n.item.Type.TILE:t instanceof ol.layer.Vector?n.item.Type.VECTOR:t instanceof ol.Overlay?n.item.Type.OVERLAY:null},r.prototype.setProperties=function(e){e.hasOwnProperty("name")&&(this.name=e.name);var t=this.getPropertyTypes(),o=this;Object.keys(t).forEach(function(t){e.hasOwnProperty(t)&&o.layer.set(t,e[t])})},r.prototype.property=function(t,e){if(void 0!==this[t])return void 0!==e&&(this[t]=e),this[t]},r.prototype.zoomTo=function(t){var e=t.getView();if(this.type===n.item.Type.OVERLAY){var o=this.layer.getPosition();if(void 0!==o)return void e.setCenter(o);w2alert("Overlay has no position defined to which to zoom.","Warning")}else{var i=this.getExtent();if(null!==i)return void e.fit(i,t.getSize());w2alert("Layer has no extent defined to which to zoom.","Warning")}},n.item.Item=function(t,e,o){var i=new r(t,e,o);return{getDetails:i.getDetails.bind(i),getProperties:i.getProperties.bind(i),getPropertyTypes:i.getPropertyTypes.bind(i),icon:i.icon,id:i.id,layer:i.layer,moving:function(t){return i.property("moving",t)},name:function(t){return i.property("name",t)},setProperties:i.setProperties.bind(i),type:i.type,zoomTo:i.zoomTo.bind(i)}},n.item.OverlayProperties={},n.item.LayerProperties={opacity:{title:"Opacity"}},n.item.Type={GROUP:0,HEATMAP:1,IMAGE:2,OVERLAY:3,TILE:4,VECTOR:5}}(olexp||{}),window.olexp.manager=window.olexp.manager||{},function(r){"use strict";var s=function(t,e,o,i,n){this.event=new r.event.Event({"select:item":[]}),this.managerLayers=new r.manager.NodeManager(i,t.getLayers(),e,o),this.layersId=i,this.managerOverlays=new r.manager.NodeManager(n,t.getOverlays(),e,o),this.map=t,this.map.on("change:layergroup",this.onLayerGroupChanged,this),this.outline=e,this.overlaysId=n};s.prototype.isIdLayerNode=function(t){return"string"==typeof t&&0===t.indexOf(this.layersId)},s.prototype.isIdOverlayNode=function(t){return"string"==typeof t&&0===t.indexOf(this.overlaysId)},s.prototype.isSelected=function(t){return t===this.outline.selected},s.prototype.getById=function(t){return this.isIdLayerNode(t)?this.managerLayers.getById(t):this.isIdOverlayNode(t)?this.managerOverlays.getById(t):null},s.prototype.getDetails=function(t){if(this.isIdLayerNode(t)){var e=this.managerLayers.getById(t);if(null!==e)return e.getDetails()}else if(this.isIdOverlayNode(t)){var o=this.managerOverlays.getById(t);if(null!==o)return o.getDetails()}return[]},s.prototype.getNode=function(t){return this.outline.get(t)},s.prototype.moveDown=function(t){return void 0===t&&(t=this.outline.selected),this.isIdLayerNode(t)?this.managerLayers.moveDown(t):!!this.isIdOverlayNode(t)&&this.managerOverlays.moveDown(t)},s.prototype.moveUp=function(t){return void 0===t&&(t=this.outline.selected),this.isIdLayerNode(t)?this.managerLayers.moveUp(t):!!this.isIdOverlayNode(t)&&this.managerOverlays.moveUp(t)},s.prototype.off=function(t,e,o){this.event.off(t,e,o),this.managerLayers.off(t,e,o),this.managerOverlays.off(t,e,o)},s.prototype.on=function(t,e,o){this.event.on(t,e,o),this.managerLayers.on(t,e,o),this.managerOverlays.on(t,e,o)},s.prototype.onItemSelected=function(t){this.event.trigger("select:item",t)},s.prototype.onLayerGroupChanged=function(t){this.managerLayers.setLayers(t.target.getLayers())},s.prototype.removeFromMap=function(t){return t.hasOwnProperty("id")?this.isIdLayerNode(t.id)?this.managerLayers.removeFromMap(t):this.isIdOverlayNode(t.id)?this.managerOverlays.removeFromMap(t):null:null},s.prototype.toggleNode=function(t){if("string"==typeof t){var e=this.outline.get(t).disabled;if(e?this.outline.enable(t):this.outline.disable(t),this.isIdLayerNode(t)){var o=this.managerLayers.getById(t);null!==o&&o.layer.setVisible(e)}else if(this.isIdOverlayNode(t)){var i=this.managerOverlays.getById(t);if(null!==i){var n=i.layer.getProperties();if(n.hasOwnProperty("element")){var r=$(n.element);e?r.show():r.hide()}}}}},s.prototype.updateItem=function(t,e){var o=this.getById(t);null!==o&&(o.setProperties(e),this.outline.get(t).text=o.name(),this.outline.refresh())},s.prototype.zoomTo=function(t){this.getById(t).zoomTo(this.map)},r.manager.Manager=function(t,e,o,i,n){var r=new s(t,e,o,i,n);return{getById:r.getById.bind(r),getDetails:r.getDetails.bind(r),getNode:r.getNode.bind(r),isSelected:r.isSelected.bind(r),moveDown:r.moveDown.bind(r),moveUp:r.moveUp.bind(r),off:r.off.bind(r),on:r.on.bind(r),onItemSelected:r.onItemSelected.bind(r),removeFromMap:r.removeFromMap.bind(r),toggleNode:r.toggleNode.bind(r),updateItem:r.updateItem.bind(r),zoomTo:r.zoomTo.bind(r)}}}(olexp||{}),function(p){"use strict";var h=function(t,e,o,i){this.count=0,this.details=i,this.event=new p.event.Event({"remove:item":[]}),this.id=t,this.items=[],this.layers=e,this.layers.on("change:length",this.onLayerChanged,this),this.managers={},this.outline=o};h.prototype.addLayer=function(t){this.count+=1;var e=this.id+"-"+this.count,o="Item "+this.count,i=t.getProperties();i.hasOwnProperty("name")&&(o=i.name);var n=new p.item.Item(e,o,t);this.items.push(n);var r={id:n.id,img:n.icon,text:n.name()},s=this.outline.get(this.id).nodes;if(0===s.length?this.outline.add(this.id,[r]):this.outline.insert(this.id,s[0].id,[r]),n.type===p.item.Type.GROUP){var a=t.getLayers(),l=new h(n.id,a,this.outline,this.details);a.forEach(function(t){l.addLayer(t)},this),this.managers[n.id]=l,this.outline.expand(n.id)}return n},h.prototype.getById=function(o,i){void 0===i&&(i=!0);var n=this,r=null;return this.items.forEach(function(t){if(null===r)if(t.id!==o){if(t.type===p.item.Type.GROUP&&i){var e=n.managers[t.id].getById(o);if(null!==e&&e.id===o)return void(r=e)}}else r=t}),r},h.prototype.getByLayer=function(o,i){void 0===i&&(i=!0);var n=this,r=null;return this.items.forEach(function(t){if(null===r)if(t.layer!==o){if(t.type===p.item.Type.GROUP&&i){var e=n.managers[t.id].getByLayer(o);if(null!==e&&e.layer===o)return void(r=e)}}else r=t}),r},h.prototype.getSize=function(){return this.items.length},h.prototype.isSelected=function(t){return t===this.outline.selected},h.prototype.isHidden=function(t){return t instanceof p.measure.Overlay},h.prototype.moveDown=function(o){var t=this.getById(o,!1);if(null!==t){var e=this.moveLayerUp(this.layers,t.layer);return e&&(e=this.moveItemDown(o)),e}var i=this,n=null;return this.items.forEach(function(t){if(null===n&&t.type===p.item.Type.GROUP){var e=i.managers[t.id].moveDown(o);if(null!==e)return void(n=e)}}),n},h.prototype.moveItemDown=function(t){var e=this.outline.get(t);if(null===e)return!1;var o=this.outline.find(e.parent.id,{parent:e.parent}),i=this.outline.get(e.parent.id,t,!0);if(i>=o.length-1)return!1;var n=o[i+1].id,r=o[i+1];return e.parent===r.parent&&(this.outline.remove(n),this.outline.insert(e.parent,t,r),this.outline.select(t),!0)},h.prototype.moveItemUp=function(t){var e=this.outline.get(t);if(null===e)return!1;var o=this.outline.find(e.parent.id,{parent:e.parent}),i=this.outline.get(e.parent.id,t,!0);if(i<=0)return!1;var n=o[i-1].id,r=o[i-1];return e.parent===r.parent&&(this.outline.remove(t),this.outline.insert(e.parent,n,e),this.outline.select(t),!0)},h.prototype.moveLayerDown=function(t,e){var o=p.util.indexOf(t,e);if(o<this.layers.getLength()-1){var i=this.getByLayer(e,!1);return i.moving(!0),t.removeAt(o),t.insertAt(o+1,e),i.moving(!1),!0}return!1},h.prototype.moveLayerUp=function(t,e){var o=p.util.indexOf(t,e);if(0<o){var i=this.getByLayer(e,!1);return i.moving(!0),t.removeAt(o),t.insertAt(o-1,e),i.moving(!1),!0}return!1},h.prototype.moveUp=function(o){var t=this.getById(o,!1);if(null!==t){var e=this.moveLayerDown(this.layers,t.layer);return e&&(e=this.moveItemUp(o)),e}var i=this,n=null;return this.items.forEach(function(t){if(null===n&&t.type===p.item.Type.GROUP){var e=i.managers[t.id].moveUp(o);if(null!==e)return void(n=e)}}),n},h.prototype.off=function(t,e,o){this.event.off(t,e,o);var i=this.getSize(),n=0;for(n=0;n<i;n+=1)this.items[n].type===p.item.Type.GROUP&&this.managers[this.items[n].id].off(t,e,o)},h.prototype.on=function(t,e,o){this.event.on(t,e,o);var i=this.getSize(),n=0;for(n=0;n<i;n+=1)this.items[n].type===p.item.Type.GROUP&&this.managers[this.items[n].id].on(t,e,o)},h.prototype.onItemRemoved=function(t){this.event.trigger("remove:item",t),this.isSelected(t.id)&&this.details.clear(),this.remove(t)},h.prototype.onLayerChanged=function(t){var e=t.target,o=0,i=null,n=e.getLength();for(o=0;o<n;o+=1)i=e.item(o),!1===this.isHidden(i)&&null===this.getByLayer(i)&&this.addLayer(i);var r=this;this.toList().forEach(function(t){!1===t.moving()&&-1===p.util.indexOf(r.layers,t.layer)&&r.onItemRemoved(t)})},h.prototype.remove=function(t){var e=this.items.indexOf(t);if(-1!==e)return this.items.splice(e,1),this.outline.remove(t.id),!0;var o=this,i=!1;return this.items.forEach(function(t){i||t.type===p.item.Type.GROUP&&o.managers[t.id].remove(t)&&(i=!0)}),i},h.prototype.removeFromMap=function(t){var e=this.layers.remove(t.layer);if(void 0!==e)return e;var o=this,i=null;return this.items.forEach(function(t){if(null===i&&t.type===p.item.Type.GROUP){var e=o.managers[t.id].removeFromMap(t);if(null!==e)return void(i=e)}}),i},h.prototype.setLayers=function(t){for(this.layers.un("change:length",this.onLayerChanged,this);0<this.items.length;)this.onItemRemoved(this.items[this.items.length-1]);this.layers=t,this.layers.on("change:length",this.onLayerChanged,this);var e=0;for(e=0;e<this.layers.getLength();e+=1)this.addLayer(this.layers.item(e))},h.prototype.toList=function(){var t=[],e=this.getSize(),o=0;for(o=0;o<e;o+=1)t.push(this.items[o]);return t},p.manager.NodeManager=function(t,e,o,i){var n=new h(t,e,o,i);return{getById:n.getById.bind(n),getByLayer:n.getByLayer.bind(n),moveDown:n.moveDown.bind(n),moveUp:n.moveUp.bind(n),off:n.off.bind(n),on:n.on.bind(n),removeFromMap:n.removeFromMap.bind(n),setLayers:n.setLayers.bind(n)}}}(olexp||{}),window.olexp.measure=window.olexp.measure||{},function(i){"use strict";i.measure.properties={area:"olexp-measure-property-area",length:"olexp-measure-property-length"};var t=function(t){ol.Overlay.call(this,t)};t.prototype=Object.create(ol.Overlay.prototype);var n=function(t,e,o){var i=$.extend(!0,{measure:{Tool:{continueLineMsg:"Click to continue drawing the line",continuePolygonMsg:"Click to continue drawing the polygon",helpTooltipOffset:[20,0],helpTooltipPositioning:"center-left",measuredStyle:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),measuringStyle:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})}),measureTooltipOffset:[0,-20],measureTooltipPositioning:"bottom-center",messageStart:"Click to start drawing. Double click to stop."}}},o);this.settings=i.measure.Tool,this.continueLineMsg=this.settings.continueLineMsg,this.continuePolygonMsg=this.settings.continuePolygonMsg,this.count=0,this.draw=null,this.drawing=!1,this.geodesic=!1,this.helpTooltip=null,this.helpTooltipElement=null,this.map=t,this.measureTooltip=null,this.measureTooltipElement=null,this.pointerMoveCallback=this.onPointerMove.bind(this),this.sketch=null,this.source=null,this.sphere=new ol.Sphere(6378137),this.type=e,this.vector=null};n.prototype.createHelpTooltip=function(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="olexp-measure olexp-measure-hidden",this.helpTooltip=new i.measure.Overlay({element:this.helpTooltipElement,offset:this.settings.helpTooltipOffset,positioning:this.settings.helpTooltipPositioning}),this.map.addOverlay(this.helpTooltip)},n.prototype.createMeasureVector=function(){this.vector=new ol.layer.Vector({source:this.source,style:this.settings.measuredStyle}),this.vector.set("name","Measurement #"+(this.count+1)),this.map.addLayer(this.vector)},n.prototype.createMeasureTooltip=function(){this.measureTooltipElement&&this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.className="olexp-measure olexp-measure-active",this.measureTooltip=new i.measure.Overlay({element:this.measureTooltipElement,offset:this.settings.measureTooltipOffset,positioning:this.settings.measureTooltipPositioning}),this.measureTooltip.set("name","Measurement #"+(this.count+1)),this.map.addOverlay(this.measureTooltip)},n.prototype.formatArea=function(t){var e=0;if(this.geodesic){var o=this.map.getView().getProjection(),i=t.clone().transform(o,"EPSG:4326").getLinearRing(0).getCoordinates();e=Math.abs(this.sphere.geodesicArea(i))}else e=t.getArea();return 1e4<e?Math.round(e/1e6*100)/100+" km<sup>2</sup>":Math.round(100*e)/100+" m<sup>2</sup>"},n.prototype.formatLength=function(t){var e=0;if(this.geodesic){var o=0,i=0,n=0,r=this.map.getView().getProjection(),s=t.getCoordinates(),a=s.length;for(o=0;o<a-1;o+=1)i=ol.proj.transform(s[o],r,"EPSG:4326"),n=ol.proj.transform(s[o+1],r,"EPSG:4326"),e+=this.sphere.haversineDistance(i,n)}else e=Math.round(100*t.getLength())/100;return 100<e?Math.round(e/1e3*100)/100+" km":Math.round(100*e)/100+" m"},n.prototype.onPointerMove=function(t){if(!t.dragging){var e=this.settings.messageStart;if(this.sketch){var o=this.sketch.getGeometry();o instanceof ol.geom.Polygon?e=this.continuePolygonMsg:o instanceof ol.geom.LineString&&(e=this.continueLineMsg)}this.helpTooltipElement.innerHTML=e,this.helpTooltip.setPosition(t.coordinate),$(this.helpTooltipElement).removeClass("olexp-measure-hidden")}},n.prototype.setEnable=function(t){t?this.map.on("pointermove",this.pointerMoveCallback):this.map.un("pointermove",this.pointerMoveCallback),this.setInteraction(t)},n.prototype.setInteraction=function(t){void 0===t&&(t=!0);var n=this;if(this.draw&&this.map.removeInteraction(this.draw),!t)return $(this.helpTooltipElement).addClass("olexp-measure-hidden"),void(this.drawing&&(this.map.removeLayer(this.vector),this.vector=null,this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=null,this.drawing=!1));$(this.helpTooltipElement).removeClass("olexp-measure-hidden"),this.source=new ol.source.Vector,this.draw=new ol.interaction.Draw({source:this.source,type:this.type,style:this.settings.measuringStyle}),this.map.addInteraction(this.draw),this.createMeasureTooltip(),this.createHelpTooltip();var o=null;this.draw.on("drawstart",function(t){this.drawing=!0,n.createMeasureVector();var i=t.coordinate;n.sketch=t.feature,o=n.sketch.getGeometry().on("change",function(t){var e="",o=t.target;o instanceof ol.geom.Polygon?(e=n.formatArea(o),i=o.getInteriorPoint().getCoordinates()):o instanceof ol.geom.LineString&&(e=n.formatLength(o),i=o.getLastCoordinate()),n.measureTooltipElement.innerHTML=e,n.measureTooltip.setPosition(i)})},this),this.draw.on("drawend",function(){this.drawing=!1,n.count+=1;var t=n.sketch.getGeometry(),e={};t instanceof ol.geom.Polygon?(e[i.measure.properties.area]=n.formatArea(t),n.vector.setProperties(e)):t instanceof ol.geom.LineString&&(e[i.measure.properties.length]=n.formatLength(t),n.vector.setProperties(e)),n.sketch=null,n.measureTooltipElement.parentNode.removeChild(n.measureTooltipElement),n.measureTooltipElement=null,n.createMeasureTooltip(),ol.Observable.unByKey(o),n.setInteraction(!0)},this)},n.prototype.setType=function(t){this.type=t},i.measure.Tool=function(t,e){void 0===e&&(e={}),void 0===e.type&&(e.type=i.measure.Type.LINE),void 0===e.settings&&(e.settings={});var o=new n(t,e.type,e.settings);return{setEnable:function(t){o.setEnable(t)},setType:function(t){o.setType(t)}}},i.measure.Type={AREA:"Polygon",LINE:"LineString"},i.measure.Overlay=t}(olexp||{}),window.olexp.menu=window.olexp.menu||{},function(c){"use strict";var i=function(t,e){var o=$.extend(!0,{menu:{Properties:{field:35,form:{},popup:{height:130,style:"width: 100%; height: 100%;",title:"Edit Layer",width:365},span:4,text:"Properties"}}},e);this.icon="olexp-menu-properties",this.form=e.prefix+"-menu-properties-form",this.id=e.prefix+"-menu-properties",this.manager=t,this.name="layerform",this.settings=o.menu.Properties};i.prototype.onClick=function(t){var e=this,o=t.target,i=this.manager.getById(o),n=i.getProperties(),r=this.settings.popup.height,s=this.settings.field,a=[];r+=s,a.push({field:"name",html:{caption:"Name",span:this.settings.span},required:!0,type:"text"});var l=i.getPropertyTypes();$.map(l,function(t){return t.title}).forEach(function(t){r+=s,a.push({field:t.toLowerCase(),html:{caption:t,span:e.settings.span},required:!0,type:"float"})});var p=$.extend(this.settings.form,{fields:a,name:this.name,record:n}),h=$.extend($.extend({},this.settings.popup),{height:r});c.util.popup(this.form,function(t){e.manager.updateItem(o,t)},p,h)},c.menu.Properties=function(t,e){var o=new i(t,e);return{menu:{id:o.id,img:o.icon,text:o.settings.text},click:function(t){o.onClick(t)}}}}(olexp||{}),function(t){"use strict";var i=function(t,e){var o=$.extend(!0,{menu:{Remove:{text:"Remove"}}},e);this.icon="olexp-menu-remove",this.id=e.prefix+"-menu-remove",this.manager=t,this.settings=o.menu.Remove};i.prototype.onClick=function(t){var e=this,o=t.target,i=this.manager.getById(o);w2confirm('Do you want to delete "'+i.name()+'"?').yes(function(){e.manager.removeFromMap(i)})},t.menu.Remove=function(t,e){var o=new i(t,e);return{menu:{id:o.id,img:o.icon,text:o.settings.text},click:function(t){o.onClick(t)}}}}(olexp||{}),function(t){"use strict";var i=function(t,e){var o=$.extend(!0,{menu:{Zoom:{text:"Zoom"}}},e);this.icon="olexp-menu-zoom",this.id=e.prefix+"-menu-zoom",this.manager=t,this.settings=o.menu.Zoom};i.prototype.onClick=function(t){var e=t.target;this.manager.zoomTo(e)},t.menu.Zoom=function(t,e){var o=new i(t,e);return{menu:{id:o.id,img:o.icon,text:o.settings.text},click:function(t){o.onClick(t)}}}}(olexp||{}),window.olexp.ol=window.olexp.ol||{},function(t){"use strict";var n=function(t,e){var o=$.extend(!0,{ol:{ToolbarShow:{html:"T",title:"Show toolbar"}}},e);this.settings=o.ol.ToolbarShow,this.explorer=t;var i=document.createElement("button");i.innerHTML=this.settings.html,i.title=this.settings.title,i.addEventListener("click",this.show.bind(this),!1),i.addEventListener("touchstart",this.show.bind(this),!1);var n=document.createElement("div");n.id=e.prefix+"-ol-toolbar-show",n.className="olexp-ol-toolbar-show ol-unselectable ol-control",n.appendChild(i),ol.control.Control.call(this,{element:n})};ol.inherits(n,ol.control.Control),n.prototype.show=function(){this.explorer.layout.show(this.explorer.options.toolbar.type),this.setMap(null)},t.ol.ToolbarShow=function(t,e){var o=$.extend({hidden:!1},e),i=new n(t,o.settings);return o.hidden&&i.setMap(t.map),i}}(olexp||{}),window.olexp.selection=window.olexp.selection||{},function(r){"use strict";var i=function(t,e){this.details=e,this.interaction=new ol.interaction.Select,this.map=t;var n=this;this.interaction.on("select",function(t){if(1===t.selected.length){var e=t.selected[0],o=r.util.toProperties(e);Object.keys(o).forEach(function(t){var e=typeof o[t];"boolean"!==e&&"number"!==e&&"string"!==e&&delete o[t]});var i=r.util.toRecords(o);n.details.clear(),n.details.add(i)}})};i.prototype.setEnable=function(t){t?this.map.addInteraction(this.interaction):this.map.removeInteraction(this.interaction)},r.selection.Feature=function(t,e){var o=new i(t,e);return{setEnable:function(t){o.setEnable(t)}}}}(olexp||{}),window.olexp.util=window.olexp.util||{},function(n){"use strict";var o=function(t){var e=$.extend(!0,{util:{Util:{Cluster:function(t){return[new ol.style.Style({image:new ol.style.Circle({radius:10,stroke:new ol.style.Stroke({color:"#ffffff"}),fill:new ol.style.Fill({color:"#3399CC"})}),text:new ol.style.Text({text:t.toString(),fill:new ol.style.Fill({color:"#ffffff"})})})]},Point:[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,255,0,0.5)"}),radius:5,stroke:new ol.style.Stroke({color:"#ff0",width:1})})})],LineString:[new ol.style.Style({stroke:new ol.style.Stroke({color:"#f00",width:3})})],Polygon:[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0,255,255,0.5)"}),stroke:new ol.style.Stroke({color:"#0ff",width:1})})],MultiPoint:[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,0,255,0.5)"}),radius:5,stroke:new ol.style.Stroke({color:"#f0f",width:1})})})],MultiLineString:[new ol.style.Style({stroke:new ol.style.Stroke({color:"#0f0",width:3})})],MultiPolygon:[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0,0,255,0.5)"}),stroke:new ol.style.Stroke({color:"#00f",width:1})})]}}},t);this.settings=e.util.Util,this.defaultStyle={Point:this.settings.Point,LineString:this.settings.LineString,Polygon:this.settings.Polygon,MultiPoint:this.settings.MultiPoint,MultiLineString:this.settings.MultiLineString,MultiPolygon:this.settings.MultiPolygon},this.clusterStyleCache={}};o.prototype.addLayerVector=function(t,e,o,i){void 0===i&&(i=!0);var n=this;o.forEach(function(t){if(!1!==i){var e=t.getGeometry();void 0!==e&&"Point"===e.getType()||(i=!1)}});var r=new ol.source.Vector({features:o});i&&(r=new ol.source.Cluster({source:r}));var s=function(t,e){var o=t.getStyleFunction();return o?o.call(t,e):n.defaultStyle[t.getGeometry().getType()]};i&&(s=function(t){return n.getClusterStyle(t)});var a=new ol.layer.Vector({source:r,style:s});a.set("name",e),t.getLayers().push(a)},o.prototype.getClusterStyle=function(t){var e=t.get("features").length,o=this.clusterStyleCache[e];return o||(o=this.settings.Cluster(e),this.clusterStyleCache[e]=o),o},o.prototype.getControls=function(){return{fullscreen:new ol.control.FullScreen,mouseposition:new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(6),projection:"EPSG:4326"}),overviewmap:new ol.control.OverviewMap,rotate:new ol.control.Rotate,scaleline:new ol.control.ScaleLine,zoom:new ol.control.Zoom,zoomslider:new ol.control.ZoomSlider,zoomtoextent:new ol.control.ZoomToExtent}},o.prototype.getDragAndDrop=function(o){var i=this,t=new ol.interaction.DragAndDrop({formatConstructors:$.map(n.util.FileTypes,function(t){return t.format})});return t.on("addfeatures",function(t){var e=n.util.setExtension(t.file.name,"");i.addLayerVector(o,e,t.features)}),t},o.prototype.getGraticule=function(t,e){var o=$.extend($.extend({},e),{color:"#"+e.color}),i=new ol.Graticule({map:t,strokeStyle:new ol.style.Stroke(o)});return i.olexpRecord=$.extend({enable:null!==t},e),i},o.prototype.getInteractions=function(t){return{draganddrop:this.getDragAndDrop(t)}},o.prototype.getTileTypes=function(){var t={};return t.osm={class:ol.source.OSM,name:"OpenStreetMap",settings:{}},t.stamenTerrain={class:ol.source.Stamen,name:"Stamen (Terrain)",settings:{layer:"terrain"}},t.stamenToner={class:ol.source.Stamen,name:"Stamen (Toner)",settings:{layer:"toner"}},t.stamenWater={class:ol.source.Stamen,name:"Stamen (Water Color)",settings:{layer:"watercolor"}},t},n.util.FileTypes={gpx:{extensions:["gpx"],format:ol.format.GPX,name:"GPX"},igc:{extensions:["igc"],format:ol.format.IGC,name:"IGC"},json:{extensions:["json","geojson"],format:ol.format.GeoJSON,name:"GeoJSON"},kml:{extensions:["kml"],format:ol.format.KML,name:"KML"}},n.util.getReader=function(t){var o=t.substring(t.lastIndexOf(".")+1).toLowerCase(),i=null;return Object.keys(n.util.FileTypes).forEach(function(t){if(null===i){var e=n.util.FileTypes[t];e.extensions.forEach(function(t){null===i&&o===t&&(i=new e.format)})}}),i},n.util.indexOf=function(t,e){var o=0,i=t.getLength();for(o=0;o<i;o+=1)if(e===t.item(o))return o;return-1},n.util.popup=function(e,o,t,i){var n=t.name,r=t.record;w2ui.hasOwnProperty(n)&&w2ui[n].destroy(),$().w2form($.extend(t,{actions:{save:function(){if(0===this.validate().length){w2popup.close();var t=w2ui[n].getChanges();o(t)}},reset:function(){var e=w2ui[n];Object.keys(r).forEach(function(t){e.record[t]=r[t]}),e.refresh()}}})),w2popup.open($.extend(i,{body:'<div id="'+e+'"></div>',onOpen:function(t){t.onComplete=function(){$("#w2ui-popup #"+e).w2render(n)}},onToggle:function(t){var e=w2ui[n];$(e.box).hide(),t.onComplete=function(){$(e.box).show(),e.resize()}}}))},n.util.setExtension=function(t,e){var o=t.split(".");return 1===o.length?o[0]:(o.pop(),o.join(".")+e)},n.util.toProperties=function(t){var e=t.getProperties();if(e.hasOwnProperty("features")){var o=e.features;if(o instanceof Array)if(1===o.length)o[0]instanceof ol.Feature&&(e=o[0].getProperties());else{var i=0;o.forEach(function(t){t instanceof ol.Feature&&(i+=1,e["Cluster Size"]=i)})}}return e},n.util.toRecords=function(o){var i=[],n=0;return Object.keys(o).forEach(function(t){var e=o[t];n+=1,i.push({recid:n,property:t,value:e})}),i},n.util.Util=function(t){var e=new o(t);return{addLayerVector:e.addLayerVector.bind(e),getControls:e.getControls.bind(e),getGraticule:e.getGraticule.bind(e),getInteractions:e.getInteractions.bind(e),getTileTypes:e.getTileTypes.bind(e)}}}(olexp||{});